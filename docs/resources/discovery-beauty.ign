{
  "ignition": {
    "version": "3.1.0"
  },
  "systemd": {
    "units": [
      {
        "name": "precache-images.service",
        "enabled": true,
        "contents": "[Unit]\nDescription=Load prestaged images in discovery stage\n\nBefore=agent.service\n\n[Service]\nType=oneshot\nUser=root\nWorkingDirectory=/var/mnt\nExecStart=bash /usr/local/bin/extract-ai.sh --label data\n#TimeoutStopSec=30\nExecStopPost=systemctl disable precache-images.service\n\n[Install]\nWantedBy=multi-user.target default.target\nWantedBy=agent.service"
      }
    ]
  },
  "storage": {
    "files": [
      {
        "overwrite": true,
        "path": "/usr/local/bin/extract-ai.sh",
        "mode": 493,
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIwojIFV0aWxpdHkgZm9yIGxvYWRpbmcgcHJlc3RhZ2VkIGltYWdlcyBkdXJpbmcgbm9kZSBpbnN0YWxsYXRpb24KIwoKUFJPRz0kKGJhc2VuYW1lICIkMCIpCgpEQVRBRElSPSIvdG1wL3ByZXN0YWdpbmciCkZTPSIvZGV2L2Rpc2svYnktcGFydGxhYmVsL2RhdGEiCgojIERldGVybWluZSB0aGUgaW1hZ2UgbGlzdCBmcm9tIHRoZSBzY3JpcHQgbmFtZSwgZXh0cmFjdC1haS5zaCBvciBleHRyYWN0LW9jcC5zaApJTUdfR1JPVVA9JChlY2hvICIke1BST0d9IiB8IHNlZCAtciAncy8uKmV4dHJhY3QtKC4qKVwuc2gvXDEvJykKSU1HX0xJU1RfRklMRT0iJHtEQVRBRElSfS8ke0lNR19HUk9VUH0taW1hZ2VzLnR4dCIKTUFQUElOR19GSUxFPSIke0RBVEFESVJ9L21hcHBpbmcudHh0IgoKIyBTZXQgdGhlIHBhcmFsbGVsaXphdGlvbiBqb2IgcG9vbCBzaXplIHRvIDgwJSBvZiB0aGUgY29yZXMKQ1BVUz0kKG5wcm9jIC0tYWxsKQpNQVhfQ1BVX01VTFQ9MC44CkpPQl9QT09MX1NJWkU9JChqcSAtbiAiJENQVVMqJE1BWF9DUFVfTVVMVCIgfCBjdXQgLWQgLiAtZjEpCgojIEdldCBpbml0aWFsIHN0YXJ0aW5nIHBvaW50IGZvciBpbmZvIGxvZyBhdCBlbmQgb2YgZXhlY3V0aW9uClNUQVJUPSR7U0VDT05EU30KCiMKIyBjbGVhbnVwOiBDbGVhbiB1cCByZXNvdXJjZXMgb24gZXhpdAojCmZ1bmN0aW9uIGNsZWFudXAgewogICAgY2QgLwogICAgaWYgbW91bnRwb2ludCAtcSAiJHtEQVRBRElSfSI7IHRoZW4KICAgICAgICB1bW91bnQgIiR7REFUQURJUn0iCiAgICBmaQoKICAgIHJtIC1yZiAiJHtEQVRBRElSfSIKfQoKdHJhcCBjbGVhbnVwIEVYSVQKCiMKIyB1c2FnZToKIwpmdW5jdGlvbiB1c2FnZSB7CiAgICBjYXQgPDxFT0YKVXNhZ2U6ICR7UFJPR30gWyAtLWxhYmVsIDxwYXJ0aXRpb24tbGFiZWw+IF0KClBhcmFtZXRlcnM6CiAgICAtLWxhYmVsIDxwYXJ0aXRpb24tbGFiZWw+ICAgICAgTGFiZWwgZm9yIHBhcnRpdGlvbiB0aGF0IGhvbGRzIHRoZSBkb3dubG9hZGVkIGltYWdlcyBhbmQgYXNzb2NpYXRlZCBmaWxlcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0OiBkYXRhCgpFT0YKICAgIGV4aXQgMQp9CgojCiMgbW91bnRfZGF0YToKIwpmdW5jdGlvbiBtb3VudF9kYXRhIHsKICAgIGlmICEgbWtkaXIgLXAgIiR7REFUQURJUn0iOyB0aGVuCiAgICAgICAgZWNobyAiJHtQUk9HfTogW0ZBSUxdIEZhaWxlZCB0byBjcmVhdGUgJHtEQVRBRElSfSIKICAgICAgICBleGl0IDEKICAgIGZpCgogICAgaWYgWyAhIC1iICIke0ZTfSIgXTsgdGhlbgogICAgICAgIGVjaG8gIiR7UFJPR306IFtGQUlMXSBOb3QgYSBibG9jayBkZXZpY2U6ICR7RlN9IgogICAgICAgIGV4aXQgMQogICAgZmkKCiAgICBpZiAhIG1vdW50ICIke0ZTfSIgIiR7REFUQURJUn0iOyB0aGVuCiAgICAgICAgZWNobyAiJHtQUk9HfTogW0ZBSUxdIEZhaWxlZCB0byBtb3VudCAke0ZTfSIKICAgICAgICBleGl0IDEKICAgIGZpCgogICAgZm9yIGYgaW4gIiR7SU1HX0xJU1RfRklMRX0iICIke01BUFBJTkdfRklMRX0iOyBkbwogICAgICAgIGlmIFsgISAtZiAiJHtmfSIgXTsgdGhlbgogICAgICAgICAgICBlY2hvICIke1BST0d9OiBbRkFJTF0gQ291bGQgbm90IGZpbmQgJHtmfSIKICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgZmkKICAgIGRvbmUKCiAgICBpZiAhIHB1c2hkICIke0RBVEFESVJ9IjsgdGhlbgogICAgICAgIGVjaG8gIiR7UFJPR306IFtGQUlMXSBGYWlsZWQgdG8gY2hkaXIgdG8gJHtEQVRBRElSfSIKICAgICAgICBleGl0IDEKICAgIGZpCn0KCiMKIyBjb3B5X2ltYWdlOiBGdW5jdGlvbiB0aGF0IGhhbmRsZXMgZXh0cmFjdGluZyBhbiBpbWFnZSB0YXJiYWxsIGFuZCBjb3B5aW5nIGl0IGludG8gY29udGFpbmVyIHN0b3JhZ2UuCiMgICAgICAgICAgICAgTGF1bmNoZWQgaW4gYmFja2dyb3VuZCBmb3IgcGFyYWxsZWxpemF0aW9uLCBvciBpbmxpbmUgZm9yIHJldHJpZXMKIwpmdW5jdGlvbiBjb3B5X2ltYWdlIHsKICAgIGxvY2FsIGN1cnJlbnRfY29weT0kMQogICAgbG9jYWwgdG90YWxfY29waWVzPSQyCiAgICBsb2NhbCB1cmk9JDMKICAgIGxvY2FsIHRhZz0kNAogICAgbG9jYWwgcmM9MAogICAgbG9jYWwgbmFtZT0KCiAgICBlY2hvICIke1BST0d9OiBbREVCVUddIEV4dHJhY3RpbmcgaW1hZ2UgJHt1cml9IgogICAgbmFtZT0kKGJhc2VuYW1lICIke3VyaS86L199IikKICAgIGlmICEgdGFyIC0tdXNlLWNvbXByZXNzLXByb2dyYW09cGlneiAteGYgIiR7bmFtZX0udGd6IjsgdGhlbgogICAgICAgIGVjaG8gIiR7UFJPR306IFtFUlJPUl0gQ291bGQgbm90IGV4dHJhY3QgdGhlIGltYWdlICR7bmFtZX0udGd6IgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGlmIFtbICIke0lNR19HUk9VUH0iID0gImFpIiAmJiAtbiAiJHt0YWd9IiAmJiAiJHt1cml9IiA9fiAiQHNoYSIgXV07IHRoZW4KICAgICAgICAjIER1cmluZyB0aGUgQUkgbG9hZGluZyBzdGFnZSwgaWYgdGhlIGltYWdlIGhhcyBhIHRhZywgbG9hZCB0aGF0IGludG8gY29udGFpbmVyIHN0b3JhZ2UgYXMgd2VsbAogICAgICAgIGVjaG8gIiR7UFJPR306IFtJTkZPXSBDb3B5aW5nICR7dXJpfSwgd2l0aCB0YWcgJHt0YWd9IFske2N1cnJlbnRfY29weX0vJHt0b3RhbF9jb3BpZXN9XSIKICAgICAgICBub3RhZz0ke3VyaS9AKn0KICAgICAgICBza29wZW8gY29weSAtLXJldHJ5LXRpbWVzIDEwICJkaXI6Ly8ke1BXRH0vJHtuYW1lfSIgImNvbnRhaW5lcnMtc3RvcmFnZToke3VyaX0iIC1xICYmIFwKICAgICAgICAgICAgc2tvcGVvIGNvcHkgLS1yZXRyeS10aW1lcyAxMCAiZGlyOi8vJHtQV0R9LyR7bmFtZX0iICJjb250YWluZXJzLXN0b3JhZ2U6JHtub3RhZ306JHt0YWd9IiAtcQogICAgICAgIHJjPSQ/CiAgICBlbHNlCiAgICAgICAgZWNobyAiJHtQUk9HfTogW0lORk9dIENvcHlpbmcgJHt1cml9IFske2N1cnJlbnRfY29weX0vJHt0b3RhbF9jb3BpZXN9XSIKICAgICAgICBza29wZW8gY29weSAtLXJldHJ5LXRpbWVzIDEwICJkaXI6Ly8ke1BXRH0vJHtuYW1lfSIgImNvbnRhaW5lcnMtc3RvcmFnZToke3VyaX0iIC1xCiAgICAgICAgcmM9JD8KICAgIGZpCgogICAgZWNobyAiJHtQUk9HfTogW0lORk9dIFJlbW92aW5nIGZvbGRlciBmb3IgJHt1cml9IgogICAgcm0gLXJmICIke25hbWV9IgoKICAgIHJldHVybiAke3JjfQp9CgojCiMgbG9hZF9pbWFnZXM6IExhdW5jaCBqb2JzIHRvIHByZXN0YWdlIGltYWdlcyBmcm9tIHRoZSBhcHByb3ByaWF0ZSBsaXN0IGZpbGUKIwpmdW5jdGlvbiBsb2FkX2ltYWdlcyB7CiAgICBsb2NhbCAtQSBwaWRzICMgSGFzaCB0aGF0IGluY2x1ZGUgdGhlIGltYWdlcyBwdWxsZWQgYWxvbmcgd2l0aCB0aGVpciBwaWRzIHRvIGJlIG1vbml0b3JlZCBieSB3YWl0IGNvbW1hbmQKICAgIGxvY2FsIC1hIGltYWdlcwogICAgbWFwZmlsZSAtdCBpbWFnZXMgPCA8KCBzb3J0IC11ICIke0lNR19MSVNUX0ZJTEV9IiApCgogICAgbG9jYWwgdG90YWxfY29waWVzPSR7I2ltYWdlc1tAXX0KICAgIGxvY2FsIGN1cnJlbnRfY29weT0wCiAgICBsb2NhbCBqb2JfY291bnQ9MAoKICAgIGVjaG8gIiR7UFJPR306IFtJTkZPXSBSZWFkeSB0byBleHRyYWN0ICR7dG90YWxfY29waWVzfSBpbWFnZXMgdXNpbmcgJEpPQl9QT09MX1NJWkUgc2ltdWx0YW5lb3VzIHByb2Nlc3NlcyIKCiAgICBmb3IgdXJpIGluICIke2ltYWdlc1tAXX0iOyBkbwogICAgICAgIGN1cnJlbnRfY29weT0kKChjdXJyZW50X2NvcHkrMSkpCgogICAgICAgICMgQ2hlY2sgdGhhdCB3ZSd2ZSBnb3QgZnJlZSBzcGFjZSBpbiB0aGUgam9iIHBvb2wKICAgICAgICB3aGlsZSBbICIke2pvYl9jb3VudH0iIC1nZSAiJHtKT0JfUE9PTF9TSVpFfSIgXTsgZG8KICAgICAgICAgICAgc2xlZXAgMC4xCiAgICAgICAgICAgIGpvYl9jb3VudD0kKGpvYnMgfCB3YyAtbCkKICAgICAgICBkb25lCgogICAgICAgIGVjaG8gIiR7UFJPR306IFtERUJVR10gUHJvY2Vzc2luZyBpbWFnZSAke3VyaX0iCiAgICAgICAgaWYgcG9kbWFuIGltYWdlIGV4aXN0cyAiJHt1cml9IjsgdGhlbgogICAgICAgICAgICBlY2hvICIke1BST0d9OiBbSU5GT10gU2tpcHBpbmcgZXhpc3RpbmcgaW1hZ2UgJHt1cml9IFske2N1cnJlbnRfY29weX0vJHt0b3RhbF9jb3BpZXN9XSIKICAgICAgICAgICAgY29udGludWUKICAgICAgICBmaQoKICAgICAgICB0YWc9JChncmVwICJeJHt1cml9PSIgIiR7TUFQUElOR19GSUxFfSIgfCBzZWQgJ3MvLio6Ly8nKQogICAgICAgIGNvcHlfaW1hZ2UgIiR7Y3VycmVudF9jb3B5fSIgIiR7dG90YWxfY29waWVzfSIgIiR7dXJpfSIgIiR7dGFnfSIgJgoKICAgICAgICBwaWRzWyR7dXJpfV09JCEgIyBLZWVwaW5nIHRyYWNrIG9mIHRoZSBQSUQgYW5kIGNvbnRhaW5lciBpbWFnZSBpbiBjYXNlIHRoZSBwdWxsIGZhaWxzCiAgICBkb25lCgogICAgZWNobyAiJHtQUk9HfTogW0RFQlVHXSBXYWl0aW5nIGZvciBqb2IgY29tcGxldGlvbiIKICAgIGZvciBpbWcgaW4gIiR7IXBpZHNbQF19IjsgZG8KICAgICAgICAjIFdhaXQgZm9yIGVhY2ggYmFja2dyb3VuZCB0YXNrIChQSUQpLiBJZiBhbnkgZXJyb3IsIHRoZW4gY29weSB0aGUgaW1hZ2UgaW4gdGhlIGZhaWxlZCBhcnJheSBzbyBpdCBjYW4gYmUgcmV0cmllZCBsYXRlcgogICAgICAgIGlmICEgd2FpdCAiJHtwaWRzWyRpbWddfSI7IHRoZW4KICAgICAgICAgICAgZWNobyAiJHtQUk9HfTogW0VSUk9SXSBQdWxsIGZhaWxlZCBmb3IgY29udGFpbmVyIGltYWdlOiAke2ltZ30gLiBSZXRyeWluZyBsYXRlci4uLiAiCiAgICAgICAgICAgIGZhaWxlZF9jb3BpZXMrPSgiJHtpbWd9IikgIyBGYWlsZWQsIHRoZW4gYWRkIHRoZSBpbWFnZSB0byBiZSByZXRyaWV2ZWQgbGF0ZXIKICAgICAgICBmaQogICAgZG9uZQp9CgojCiMgcmV0cnlfaW1hZ2VzOiBSZXRyeSBsb2FkaW5nIGFueSBmYWlsZWQgaW1hZ2VzIGludG8gY29udGFpbmVyIHN0b3JhZ2UKIwpmdW5jdGlvbiByZXRyeV9pbWFnZXMgewogICAgbG9jYWwgdG90YWxfY29waWVzPSR7I2ZhaWxlZF9jb3BpZXNbQF19CgogICAgaWYgWyAiJHt0b3RhbF9jb3BpZXN9IiAtZXEgMCBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgbG9jYWwgcmM9MAogICAgbG9jYWwgdGFnCiAgICBsb2NhbCBjdXJyZW50X2NvcHk9MAoKICAgIGVjaG8gIiR7UFJPR306IFtSRVRSWUlOR10iCiAgICBmb3IgZmFpbGVkX2NvcHkgaW4gIiR7ZmFpbGVkX2NvcGllc1tAXX0iOyBkbwogICAgICAgIGN1cnJlbnRfY29weT0kKChjdXJyZW50X2NvcHkrMSkpCgogICAgICAgIGVjaG8gIiR7UFJPR306IFtSRVRSWV0gUmV0cnlpbmcgZmFpbGVkIGltYWdlIHB1bGw6ICR7ZmFpbGVkX2NvcHl9IgoKICAgICAgICB0YWc9JChncmVwICJeJHt1cml9PSIgIiR7TUFQUElOR19GSUxFfSIgfCBzZWQgJ3MvLio6Ly8nKQogICAgICAgIGNvcHlfaW1hZ2UgIiR7Y3VycmVudF9jb3B5fSIgIiR7dG90YWxfY29waWVzfSIgIiR7dXJpfSIgIiR7dGFnfSIKICAgICAgICByYz0kPwogICAgZG9uZQoKICAgIGVjaG8gIiR7UFJPR306IFtJTkZPXSBJbWFnZSBsb2FkIGRvbmUiCiAgICByZXR1cm4gIiR7cmN9Igp9CgppZiBbWyAiJHtCQVNIX1NPVVJDRVswXX0iID0gIiR7MH0iIF1dOyB0aGVuCiAgICAjCiAgICAjIFByb2Nlc3MgY21kbGluZSBhcmd1bWVudHMKICAgICMKCiAgICBsb25nb3B0cz0oCiAgICAgICAgImhlbHAiCiAgICAgICAgImxhYmVsOiIKICAgICkKCiAgICBsb25nb3B0c19zdHI9JChJRlM9LDsgZWNobyAiJHtsb25nb3B0c1sqXX0iKQoKICAgIGlmICEgT1BUUz0kKGdldG9wdCAtbyAiaGw6IiAtLWxvbmcgIiR7bG9uZ29wdHNfc3RyfSIgLS1uYW1lICIkMCIgLS0gIiRAIik7IHRoZW4KICAgICAgICB1c2FnZQogICAgICAgIGV4aXQgMQogICAgZmkKCiAgICBldmFsIHNldCAtLSAiJHtPUFRTfSIKCiAgICB3aGlsZSA6OyBkbwogICAgICAgIGNhc2UgIiQxIiBpbgogICAgICAgICAgICAtbHwtLWxhYmVsKQogICAgICAgICAgICAgICAgRlM9Ii9kZXYvZGlzay9ieS1wYXJ0bGFiZWwvJHsyfSIKICAgICAgICAgICAgICAgIHNoaWZ0IDIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0tKQogICAgICAgICAgICAgICAgc2hpZnQKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAtaHwtLWhlbHApCiAgICAgICAgICAgICAgICB1c2FnZQogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgKikKICAgICAgICAgICAgICAgIHVzYWdlCiAgICAgICAgICAgICAgICA7OwogICAgICAgIGVzYWMKICAgIGRvbmUKCiAgICBmYWlsZWRfY29waWVzPSgpICMgQXJyYXkgdGhhdCB3aWxsIGluY2x1ZGUgYWxsIHRoZSBpbWFnZXMgdGhhdCBmYWlsZWQgdG8gYmUgcHVsbGVkCgogICAgbW91bnRfZGF0YQoKICAgIGxvYWRfaW1hZ2VzCgogICAgaWYgISByZXRyeV9pbWFnZXM7IHRoZW4KICAgICAgICBlY2hvICIke1BST0d9OiBbRkFJTF0gJHsjZmFpbGVkX2NvcGllc1tAXX0gaW1hZ2VzIHdlcmUgbm90IGxvYWRlZCBzdWNjZXNzZnVsbHksIGFmdGVyICQoKFNFQ09ORFMtU1RBUlQpKSBzZWNvbmRzIiAjbnVtYmVyIG9mIGZhaWxpbmcgaW1hZ2VzCiAgICAgICAgZXhpdCAxCiAgICBlbHNlCiAgICAgICAgZWNobyAiJHtQUk9HfTogW1NVQ0NFU1NdIEFsbCBpbWFnZXMgd2VyZSBsb2FkZWQsIGluICQoKFNFQ09ORFMtU1RBUlQpKSBzZWNvbmRzIgogICAgICAgIGV4aXQgMAogICAgZmkKZmkK"
        }
      }
    ]
  }
}
